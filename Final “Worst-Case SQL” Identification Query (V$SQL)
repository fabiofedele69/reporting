SELECT
    sql_id,
    executions,

    -- total elapsed time (minutes)
    ROUND(elapsed_time / 1e6 / 60, 2) AS total_elapsed_min,

    -- average elapsed time per execution (minutes)
    ROUND(
        (elapsed_time / NULLIF(executions, 0)) / 1e6 / 60,
        2
    ) AS avg_elapsed_min,

    -- CPU time (minutes)
    ROUND(cpu_time / 1e6 / 60, 2) AS cpu_min,

    buffer_gets,
    disk_reads,
    last_active_time,

    SUBSTR(sql_text, 1, 120) AS sql_text_snippet
FROM v$sql
WHERE executions > 0
AND elapsed_time > 300 * 1e6          -- total elapsed > 5 minutes
AND (elapsed_time / executions) > 60 * 1e6   -- avg exec > 1 minute
ORDER BY avg_elapsed_min DESC
FETCH FIRST 20 ROWS ONLY;


SELECT *
FROM table(dbms_xplan.display_cursor(
  'SQL_ID',
  NULL,
  'ALLSTATS LAST'
));


SELECT status, elapsed_time/1e6 elapsed_sec
FROM v$sql_monitor
WHERE sql_id = 'SQL_ID';
