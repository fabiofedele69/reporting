CREATE OR REPLACE VIEW LC_SCMT.VW_FCSGMT_GFUI_NEW_FF_SAFE AS
SELECT
    CASE_ID,
    SOURCE,
    INVESTIGATING_REGION_TEAM,
    CASE_BU,
    CASE_DIVISION,
    CASE_REGIONS,
    CASE_COUNTRIES,
    LINE_OF_BUSINESS,
    LEGAL_ENTITIES,
    BUSINESS_AREA,
    CAST(CASE_NAME AS VARCHAR2(4000 CHAR)) AS CASE_NAME,
    CASE_STATE,
    CASE_STEP,
    DATE_CASE_CREATED,
    DATE_CASE_COMPLETED,
    DATE_CASE_CLOSED,
    DATE_REOPENED,
    CAST(SUBSTR(REFERRAL1 || ' - ' || REFERRAL2, 1, 4000) AS VARCHAR2(4000 CHAR)) AS REFERRAL,
    REFERRAL_CONTACT,
    REFERRAL_CONTACT_OU_NM,
    CASE_TRIGGER,
    SUMMARY_TRIGGER,
    CASE_TAGS,
    XML_GENERATION_DATE,
    CAST(
        CASE
            WHEN FCSCMT_ELEMENT_ID IS NOT NULL
                 AND (OUTCOME_SUB_TYPE IN (SELECT * FROM SAR_OUTCOME_SUB_TYPES)
                      OR OUTCOME_TYPE IN (
                          'Client Relationship Exit','Account Closure','Continuation/Retain Client Relationship',
                          'Continuation','Closed Already','Closed Business Relationship'))
            THEN ELEMENT_TYPE
            ELSE ''
        END AS VARCHAR2(4000 CHAR)
    ) AS ELEMENT_TYPE,
    FCSCMT_ELEMENT_ID,
    ELEMENT_ID,
    CAST(
        CASE
            WHEN OUTCOME_SUBTYPE IS NOT NULL THEN 'Y'
            ELSE 'N'
        END AS VARCHAR2(1 CHAR)
    ) AS SAR_FILED,
    -- this replaces MAX_SAR_COMPLETION_DT
    MAX_SAR_COMPLETION_DT AS SAR_FILING_DATE,
    CAST(
        CASE
            WHEN FCSCMT_ELEMENT_ID IS NOT NULL
                 AND OUTCOME_TYPE IN ('Client Relationship Exit','Exit','Account Closure') THEN 'Exit'
            WHEN FCSCMT_ELEMENT_ID IS NOT NULL
                 AND OUTCOME_TYPE IN ('Continuation/Retain Client Relationship','Continuation') THEN 'Continuation'
            WHEN FCSCMT_ELEMENT_ID IS NOT NULL
                 AND OUTCOME_TYPE IN ('Closed Already','Closed Business Relationship') THEN 'Closed Already'
            ELSE ''
        END AS VARCHAR2(100 CHAR)
    ) AS ELEMENT_DECISION,
    PARTNER_TYPE,
    PARTY_ROLE,
    CAST(PARTNER_NAME AS VARCHAR2(4000 CHAR)) AS PARTNER_NAME,
    CAST(PARTNER_INDUSTRIES AS VARCHAR2(4000 CHAR)) AS PARTNER_INDUSTRIES,
    CAST(PARTNER_DOMICILE_COUNTRIES AS VARCHAR2(4000 CHAR)) AS PARTNER_DOMICILE_COUNTRIES,
    CAST(PARTNER_NATIONALITY_COUNTRIES AS VARCHAR2(4000 CHAR)) AS PARTNER_NATIONALITY_COUNTRIES,
    CAST(ACCOUNT_NAME AS VARCHAR2(4000 CHAR)) AS ACCOUNT_NAME,
    CAST(ACCOUNT_STATUS AS VARCHAR2(4000 CHAR)) AS ACCOUNT_STATUS,
    CAST(BR_NAME AS VARCHAR2(4000 CHAR)) AS BR_NAME,
    BR_STATUS_POINT_IN_TIME,
    CURRENT_BR_STATUS,
    BR_BALANCE_POINT_IN_TIME,
    CURRENT_BR_BALANCE,
    BR_CURRENCY,
    RELATIONSHIP_STRATEGY,
    CASE_CREATED_BY,
    CASE_OWNER,
    CASE_OWNER_GPN,
    PREDICATE_OFFENSE,
    COMPLIANCE_UNIT,
    RISK_RATING,
    ML_PHASE,
    PEP,
    SCAP,
    SIAP,
    NTBR,
    SIM,
    FIFTY_PLUS,
    FISCAL_RISK,
    CAST(DBMS_LOB.SUBSTR(SUMMARY_ANALYSIS, 3000, 1) AS VARCHAR2(4000 CHAR)) AS SUMMARY_ANALYSIS,
    CAST(DBMS_LOB.SUBSTR(SUMMARY_CONCLUSION, 3000, 1) AS VARCHAR2(4000 CHAR)) AS SUMMARY_CONCLUSION,
    CAST(CASE_DESCRIPTION AS VARCHAR2(4000 CHAR)) AS CASE_DESCRIPTION,
    CONFIDENTIAL,
    DATE_LAST_UPDATE,
    CAST(OUTCOME_SUBTYPE AS VARCHAR2(4000 CHAR)) AS OUTCOME_SUBTYPE
FROM LC_SCMT.VW_FCSGMT_GFUI_NEW_FF;
